<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Akun Admin | Serbu Ramadhan</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- CONTENT -->
    <div class="container my-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <!-- TOMBOL KEMBALI -->
                <button class="btn btn-light btn-sm mb-3 d-flex align-items-center gap-1"
                    onclick="window.history.back()">
                    <i class="bi bi-arrow-left"></i> Kembali
                </button>


                <div class="card shadow-sm rounded-4">
                    <div id="loadingAkun" class="text-center py-4">
                        <div class="spinner-border text-primary"></div>
                        <p class="small text-muted mt-2">Memuat data akun...</p>
                    </div>
                    <div class="card-body p-4 d-none" id="akunContent">
                        <!-- INFORMASI AKUN -->
                        <h6 class="fw-semibold mb-3">
                            <i class="bi bi-person-circle me-2"></i> Informasi Akun
                        </h6>

                        <div class="mb-3">
                            <label class="form-label small text-muted">Nama</label>
                            <input type="text" class="form-control form-control-sm" id="akunNama" readonly>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small text-muted">Email</label>
                            <input type="email" class="form-control form-control-sm" id="akunEmail" readonly>
                        </div>

                        <!-- PASSWORD -->
                        <div class="mb-4">
                            <label class="form-label small text-muted">Password</label>
                            <div class="input-group input-group-sm">
                                <input type="password" class="form-control" id="akunPassword" readonly>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="togglePassword(this, 'akunPassword')">
                                    <i class="bi bi-eye-slash"></i>
                                </button>
                            </div>
                            <small class="text-muted">
                                Demi keamanan, password tidak dapat diedit di sini
                            </small>
                        </div>

                        <button class="btn btn-outline-primary btn-sm w-100" data-bs-toggle="modal"
                            data-bs-target="#modalEditProfil">
                            <i class="bi bi-pencil-square me-1"></i> Edit Profil
                        </button>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEditProfil" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4">

                <div class="modal-header">
                    <h6 class="modal-title fw-semibold">
                        <i class="bi bi-pencil-square me-2"></i> Edit Profil
                    </h6>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form id="formEditProfil">
                    <div class="modal-body">

                        <div class="mb-3">
                            <label class="form-label small">Nama Lengkap</label>
                            <input type="text" class="form-control form-control-sm" id="editNama" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small">Email</label>
                            <input type="email" class="form-control form-control-sm" id="editEmail" required>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                            Batal
                        </button>
                        <button class="btn btn-primary btn-sm">
                            <i class="bi bi-save me-1"></i> Simpan
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>


    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const admin = JSON.parse(localStorage.getItem("adminLogin"));
        if (!admin) {
            window.location.href = "../login-admin.html";
            return;
        }

        // delay kecil biar terasa dinamis
        setTimeout(() => {
            loadingAkun.classList.add("d-none");
            akunContent.classList.remove("d-none");

            akunNama.value = admin.nama;
            akunEmail.value = admin.email;
            akunPassword.value = admin.password;

            editNama.value = admin.nama;
            editEmail.value = admin.email;

            if (typeof navUsername !== "undefined") {
                navUsername.innerText = admin.nama;
            }
        }, 600);
    });

        function togglePassword(btn, inputId) {
            const input = document.getElementById(inputId);
            const icon = btn.querySelector("i");

            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace("bi-eye-slash", "bi-eye");
            } else {
                input.type = "password";
                icon.classList.replace("bi-eye", "bi-eye-slash");
            }
        }

        function logout() {
            localStorage.removeItem("adminLogin");
            window.location.href = "../login-admin.html";
        }

        // isi otomatis saat modal dibuka
        document.getElementById("modalEditProfil").addEventListener("show.bs.modal", () => {
            const admin = JSON.parse(localStorage.getItem("adminLogin"));
            editNama.value = admin.nama;
            editEmail.value = admin.email;
        });

        document.getElementById("formEditProfil").addEventListener("submit", e => {
            e.preventDefault();

            let admin = JSON.parse(localStorage.getItem("adminLogin"));
            let akunAdmin = JSON.parse(localStorage.getItem("akunAdmin")) || [];

            const nama = editNama.value.trim();
            const email = editEmail.value.trim().toLowerCase();

            // update database akun
            akunAdmin = akunAdmin.map(a =>
                a.email === admin.email ? { ...a, nama, email } : a
            );

            admin.nama = nama;
            admin.email = email;

            localStorage.setItem("akunAdmin", JSON.stringify(akunAdmin));
            localStorage.setItem("adminLogin", JSON.stringify(admin));

            // update tampilan
            akunNama.value = nama;
            akunEmail.value = email;
            navUsername.innerText = nama;

            bootstrap.Modal.getInstance(
                document.getElementById("modalEditProfil")
            ).hide();

            alert("Profil berhasil diperbarui");
        });

    </script>

</body>

</html>